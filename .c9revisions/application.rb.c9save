{"ts":1374024466927,"silentsave":true,"restoring":false,"patch":[[]],"length":0}
{"contributors":[],"silentsave":false,"ts":1374024511394,"patch":[[{"diffs":[[1,"require \"mysql2\"\nrequire \"CSV\"\nrequire \"yaml\"\n\nconfig = YAML::load(open(\"#{File.expand_path(File.dirname(_FILE_))}/configs/configs.yml\"))[\"mysql\"]\nclient = Mysql2::Client.new(:host => \"localhost\", :username => \"root\", :database => \"patrick_class\")\n\nfiles = \"*.csv\"\nfiles = Dir.glob files\np files\n\n\nclient.query \"truncate table customers\"\nclass FormatDate\n def self.format(date)\n     Date.strptime(date, \"%m/%d/%Y\").strftime(\"%Y-%m-%d\")\n end\nend\nbegin\n # File.readlines(file).map { |records|\n \t# records = records.gsub(\"\\n\",\"\")\n \t# p records \n \t# records = records.split(\",\")\n  \n # }\n  \n files.each { |file|\n \tp file\n \tCSV.foreach(file, :headers => :first_row) { |records|\n \tp records\n \tfname = records[0].gsub(\"'\",\"''\")\n \tlname = records[1].gsub(\"'\",\"''\")\n \tdob = FormatDate.format(records[2])\n \tdob = Date.strptime(records[2], \"%m/%d/%Y\").strftime(\"%Y-%m-%d\")\n \tage = records[3]\n \tp \"Insert into customers values('#{fname}', '#{lname}','#{dob}','#{age}')\"\n \tclient.query \"Insert into customers values('#{fname}', '#{lname}','#{age}','#{dob}','#{Time.now.strftime(\"%Y-%m-%d %H:%M:%S\")}')\"\n \t \n \t}\n }\n  \n  \nrescue Exception => e\n @message = e.message\n exit\nend\n\nfiles.each{|file| FileUtils.mv(file, \"backup/\")}"]],"start1":0,"start2":0,"length1":0,"length2":1209}]],"length":1209,"saved":false}
{"contributors":[],"silentsave":false,"ts":1374025656084,"patch":[[{"diffs":[[0,"ire "],[-1,"\""],[1,"'"],[0,"mysql2"],[-1,"\""],[1,"'"],[0,"\nreq"]],"start1":4,"start2":4,"length1":16,"length2":16},{"diffs":[[0,"ire "],[-1,"\"CSV\""],[1,"'yaml'"],[0,"\nreq"]],"start1":21,"start2":21,"length1":13,"length2":14},{"diffs":[[0,"ire "],[-1,"\"yaml\"\n"],[1,"'fileutils'\nrequire 'csv'\nload 'functions/functions.rb'"],[0,"\ncon"]],"start1":36,"start2":36,"length1":15,"length2":63},{"diffs":[[0,"me(_"],[1,"_"],[0,"FILE_"],[1,"_"],[0,"))}/"]],"start1":151,"start2":151,"length1":13,"length2":15},{"diffs":[[0," => "],[-1,"\"local"],[1,"config[\""],[0,"host\""],[1,"]"],[0,", :u"]],"start1":231,"start2":231,"length1":19,"length2":22},{"diffs":[[0," => "],[-1,"\"root\", :database => \"patrick_class\""],[1,"config[\"username\"], :database => config[\"database\"]"],[0,")\n\nf"]],"start1":260,"start2":260,"length1":44,"length2":59},{"diffs":[[0,"p files\n"],[-1,"\n\n"],[0,"client.q"]],"start1":357,"start2":357,"length1":18,"length2":16},{"diffs":[[0,"uery"],[-1," \"t"],[1,"(\"T"],[0,"runc"]],"start1":373,"start2":373,"length1":11,"length2":11},{"diffs":[[0,"e table "],[-1,"c"],[1,"C"],[0,"ustomers"]],"start1":386,"start2":386,"length1":17,"length2":17},{"diffs":[[0,"ers\""],[-1,"\nclass FormatDate\n def self.f"],[1,")\nbegin\n  files.each { |file|\n  p file\n    CSV.foreach(file, :headers => :first_row) { |record|\n      p record\n      fname = record[0]\n      lname = record[1]\n      dob = F"],[0,"ormat"],[-1,"(date)\n    "],[1,"Date.new(record[2]).newMethod\n      #dob ="],[0," Dat"]],"start1":400,"start2":400,"length1":53,"length2":227},{"diffs":[[0,"ime("],[-1,"date"],[1,"record[2]"],[0,", \"%"]],"start1":634,"start2":634,"length1":12,"length2":17},{"diffs":[[0,"\")\n "],[-1,"end\nend\nbegin\n"],[1,"     age = record[3]\n      #p \"#{fname}, #{lname}, #{dob}, #{age}\"\n      client.query \"Insert into Customers Values('#{fname}', '#{lname}', '#{age}', '#{dob}', '#{Time.now.strftime(\"%Y-%m-%d %H:%M:%S\")}')\"\n    }\n   "],[0," # F"]],"start1":679,"start2":679,"length1":22,"length2":223},{"diffs":[[0,"adlines("],[-1,"file"],[1,"\"customers.txt\""],[0,").map { "]],"start1":908,"start2":908,"length1":20,"length2":31},{"diffs":[[0,"cords|\n "],[-1,"\t#"],[1,"   #  "],[0," records"]],"start1":942,"start2":942,"length1":18,"length2":22},{"diffs":[[0,"\\n\","],[1," "],[0,"\"\")\n "],[-1,"\t# p records \n \t#"],[1,"   #  "],[0," rec"]],"start1":981,"start2":981,"length1":30,"length2":20},{"diffs":[[0,")\n  "],[-1,"\n # }\n  \n files.each { |file|\n \tp file\n \tCSV.foreach(file, :headers => :first_row) { |records|\n \tp records\n \tfname = records[0].gsub(\"'\",\"''\")\n \tlname = records[1].gsub(\"'\",\"''\")\n \tdob = FormatDate.format(records[2])\n \t"],[1,"  #   fname = records[0]\n    #   lname = records[1]\n    #   "],[0,"dob "]],"start1":1025,"start2":1025,"length1":227,"length2":68},{"diffs":[[0,"m-%d\")\n "],[-1,"\t"],[1,"   #   "],[0,"age = re"]],"start1":1147,"start2":1147,"length1":17,"length2":23},{"diffs":[[0,"3]\n "],[-1,"\tp \"Insert into customers values('#{fname}', '#{lname}','#{dob}','#{age}')\"\n \t"],[1,"   #   "],[0,"clie"]],"start1":1176,"start2":1176,"length1":86,"length2":15},{"diffs":[[0,"rt into "],[-1,"c"],[1,"C"],[0,"ustomers"]],"start1":1205,"start2":1205,"length1":17,"length2":17},{"diffs":[[0,"stomers "],[-1,"v"],[1,"V"],[0,"alues('#"]],"start1":1215,"start2":1215,"length1":17,"length2":17},{"diffs":[[0,"lname}',"],[1," "],[0,"'#{age}'"]],"start1":1245,"start2":1245,"length1":16,"length2":17},{"diffs":[[0,"#{age}',"],[1," "],[0,"'#{dob}'"]],"start1":1255,"start2":1255,"length1":16,"length2":17},{"diffs":[[0,"#{dob}',"],[1," "],[0,"'#{Time."]],"start1":1265,"start2":1265,"length1":16,"length2":17},{"diffs":[[0,")\"\n "],[-1,"\t \n \t}\n"],[1,"   #"],[0," }\n  "],[-1,"\n  "],[1,"}"],[0,"\nres"]],"start1":1317,"start2":1317,"length1":23,"length2":18},{"diffs":[[0," e\n "],[-1,"@"],[1," $"],[0,"mess"]],"start1":1351,"start2":1351,"length1":9,"length2":10},{"diffs":[[0,"message\n"],[1," "],[0," exit\nen"]],"start1":1369,"start2":1369,"length1":16,"length2":17},{"diffs":[[0,"it\nend\n\n"],[1,"# if $message == nil\n  "],[0,"files.ea"]],"start1":1381,"start2":1381,"length1":16,"length2":39},{"diffs":[[0,"ckup"],[1,"s"],[0,"/\")}"],[1,"\n# end\n# alert = []\n# alert << \"Hello\"\n\n# p alert"]],"start1":1452,"start2":1452,"length1":8,"length2":58}]],"length":1510,"saved":false}
{"contributors":[],"silentsave":false,"ts":1374116034958,"patch":[[{"diffs":[[0,")\nbegin\n"],[1,"  "],[0,"  files."]],"start1":404,"start2":404,"length1":16,"length2":18},{"diffs":[[0," |file|\n"],[1,"  "],[0,"  p file"]],"start1":428,"start2":428,"length1":16,"length2":18},{"diffs":[[0," p file\n"],[1,"        client.query \"BEGIN\"\n    "],[0,"    CSV."]],"start1":439,"start2":439,"length1":16,"length2":49},{"diffs":[[0,"|\n      "],[1,"  "],[0,"p record"]],"start1":535,"start2":535,"length1":16,"length2":18},{"diffs":[[0," record\n"],[1,"  "],[0,"      fn"]],"start1":546,"start2":546,"length1":16,"length2":18},{"diffs":[[0,"= record[0]\n"],[1,"  "],[0,"      lname "]],"start1":568,"start2":568,"length1":24,"length2":26},{"diffs":[[0,"]\n      "],[1,"  "],[0,"dob = Fo"]],"start1":604,"start2":604,"length1":16,"length2":18},{"diffs":[[0,"    "],[-1,"#dob = Date.strptime(record[2], \"%m/%d/%Y\").strftime(\"%Y-%m-%d\")\n      age = record[3]\n      #p \"#{fname}, #{lname}, #{dob}, #{age}\"\n"],[1,"  age = record[3]\n    "],[0,"    "]],"start1":658,"start2":658,"length1":141,"length2":30},{"diffs":[[0,"%M:%S\")}')\"\n"],[1,"    "],[0,"    }\n    # "]],"start1":811,"start2":811,"length1":24,"length2":28},{"diffs":[[0,"    "],[-1,"# File.readlines(\"c"],[1,"}\n    client.query \"Insert into Logs values('C"],[0,"ustomers"],[-1,".txt\").map { |records|\n    #   records = records.gsub(\"\\n\", \"\")\n    #   records = records.split(\",\")\n    #   fname = records[0]\n    #   lname = records[1]\n    #   dob = Date.strptime(records[2], \"%m/%d/%Y\").strftime(\"%Y-%m-%d\")\n    #   age = records[3]\n    #"],[1," Load', '#{$message.gsub(\"'\",\"''\")}', 'Success', '#{Time.now.strftime(\"%Y-%m-%d %H:%M:%S\")}')\"\n    files.each{|file| FileUtils.mv(file, \"backups/\")}\nrescue Exception => e\n    $message = e.message\n    client.query \"ROLLBACK\"\n "],[0,"   c"]],"start1":833,"start2":833,"length1":293,"length2":287},{"diffs":[[0,"nto "],[-1,"Customers V"],[1,"Logs v"],[0,"alues('"],[-1,"#{fname}', '#{lname}', '#{age}', '#{dob}', '#{Time.now.strftime(\"%Y-%m-%d %H:%M:%S\")}')\"\n    # }\n  }\nrescue Exception => e\n  $message = e.message\n  exit\nend\n\n# if $message == nil\n  files.each{|file| FileUtils.mv(file, \"backups/\")}\n# end\n# alert = []\n# alert << \"Hello\"\n\n# p alert"],[1,"Customers Load', '#{$message.gsub(\"'\",\"''\")}', 'Failed', '#{Time.now.strftime(\"%Y-%m-%d %H:%M:%S\")}')\"\nensure\n    client.query \"COMMIT\"    \nend\n\n"]],"start1":1141,"start2":1141,"length1":301,"length2":162}]],"length":1303,"saved":false}
{"ts":1374116143495,"patch":[[{"diffs":[[0,"d', "],[-1,"'#{$message.gsub(\"'\",\"''\")}'"],[0,", 'S"]],"start1":895,"start2":895,"length1":36,"length2":8}]],"length":1275,"saved":false}
{"ts":1374116154300,"patch":[[{"diffs":[[0," Load', "],[1,"''"],[0,", 'Succe"]],"start1":891,"start2":891,"length1":16,"length2":18}]],"length":1277,"saved":false}
{"ts":1374116891609,"patch":[[{"diffs":[[0,"rd[3]\n          "],[1,"  "],[0,"client.query \"In"]],"start1":674,"start2":674,"length1":32,"length2":34}]],"length":1279,"saved":false}
{"ts":1374117264247,"patch":[[{"diffs":[[0,")\nbegin\n"],[-1,"  "],[0,"  files."]],"start1":404,"start2":404,"length1":18,"length2":16},{"diffs":[[0," p file\n"],[-1,"    "],[0,"    clie"]],"start1":437,"start2":437,"length1":20,"length2":16},{"diffs":[[0,"\"BEGIN\"\n"],[-1,"    "],[0,"    CSV."]],"start1":462,"start2":462,"length1":20,"length2":16},{"diffs":[[0,"|\n      "],[-1," "],[-1," "],[0,"p record"]],"start1":525,"start2":525,"length1":18,"length2":16},{"diffs":[[0," record\n"],[-1,"  "],[0,"      fn"]],"start1":534,"start2":534,"length1":18,"length2":16},{"diffs":[[0,"cord[0]\n"],[-1,"  "],[0,"      ln"]],"start1":558,"start2":558,"length1":18,"length2":16},{"diffs":[[0,"]\n      "],[-1,"  "],[0,"dob = Fo"]],"start1":588,"start2":588,"length1":18,"length2":16},{"diffs":[[0,"d\n      "],[-1,"  "],[0,"age = re"]],"start1":636,"start2":636,"length1":18,"length2":16},{"diffs":[[0,"]\n      "],[-1," "],[-1,"     "],[0,"client.q"]],"start1":658,"start2":658,"length1":22,"length2":16},{"diffs":[[0,"    "],[-1,"    }\n  "],[1,"}\n"],[0,"  }\n"],[-1,"  "],[0,"  cl"]],"start1":799,"start2":799,"length1":22,"length2":14},{"diffs":[[0,"S\")}')\"\n"],[-1,"  "],[0,"  files."]],"start1":920,"start2":920,"length1":18,"length2":16},{"diffs":[[0," => e\n  "],[-1," "],[-1," "],[0,"$message"]],"start1":996,"start2":996,"length1":18,"length2":16},{"diffs":[[0,"message\n"],[-1,"  "],[0,"  client"]],"start1":1017,"start2":1017,"length1":18,"length2":16},{"diffs":[[0,"LLBACK\"\n"],[-1,"  "],[0,"  client"]],"start1":1043,"start2":1043,"length1":18,"length2":16},{"diffs":[[0,"\nensure\n"],[-1,"  "],[0,"  client"]],"start1":1194,"start2":1194,"length1":18,"length2":16}]],"length":1235,"saved":false}
{"ts":1374117387041,"patch":[[{"diffs":[[0,"{ |file|"],[1,"   "],[0,"\n    p f"]],"start1":425,"start2":425,"length1":16,"length2":19}]],"length":1238,"saved":false}
{"ts":1374117397771,"patch":[[{"diffs":[[0,"{ |file|"],[-1,"   "],[0,"\n    p f"]],"start1":425,"start2":425,"length1":19,"length2":16}]],"length":1235,"saved":false}
